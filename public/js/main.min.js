'use strict';

class Card {
	constructor() {
		this._cards = Array.from(document.querySelectorAll('.card'));
		this._is_liked = 'card__button_is-liked';
		this._is_disliked = 'card__button_is-disliked';
		this._svg_liked = 'svg__card_is-liked';
		this._svg_disliked = 'svg__card_is-disliked';

		this._addEventListener();
	}

	_addEventListener() {
		this._cards.forEach(card => {
			const the_buttons = Array.from(card.querySelectorAll('.card__button'));
			
			this._handleCard(the_buttons, card);
		});
	}

	_handleCard(buttons, card) {
		buttons.forEach(button => {
			button.addEventListener('click', _ => this._toggleCardButton(button, buttons, card));
		});
	}

	_toggleCardButton(current_button, buttons, card) {
		if (current_button.classList.contains('card__button_dislike')) {
			if (current_button.classList.contains('card__button_is-disliked')) {
				current_button.classList.remove('card__button_is-disliked');
				current_button.querySelector('svg').classList.remove('svg__card_is-disliked');
			} else {
				current_button.classList.add('card__button_is-disliked');
				current_button.querySelector('svg').classList.add('svg__card_is-disliked');

				buttons.forEach(button =>  {
					if (button !== current_button) {
						button.classList.remove('card__button_is-liked');
						button.querySelector('svg').classList.remove('svg__card_is-liked');
					}
				});

				//add the feedback to the database
				const url = current_button.getAttribute('data-href');
			}
		} else if (current_button.classList.contains('card__button_like')) {
			if (current_button.classList.contains('card__button_is-liked')) {
				current_button.classList.remove('card__button_is-liked');
				current_button.querySelector('svg').classList.remove('svg__card_is-liked');
			} else {
				current_button.classList.add('card__button_is-liked');
				current_button.querySelector('svg').classList.add('svg__card_is-liked');

				buttons.forEach(button =>  {
					if (button !== current_button) {
						button.classList.remove('card__button_is-disliked');
						button.querySelector('svg').classList.remove('svg__card_is-disliked');
					}
				});

				//add the feedback to the database
				const url = current_button.getAttribute('data-href');
			}
		} else {
			card.classList.add('card__is-removed');
			setTimeout(_ => card.classList.add('hidden'), 400);

			const url = current_button.getAttribute('data-href');
			console.log(url);
		}
	}

	_cardStatus(url, card) {
		const id = card.getAttribute('data-shop');
		const options = {
			method: 'PUT',
			body: {'id': id}
		};

		fetch(url, options)
			.then(res => res.json())
			.then(response => console.log(response));
	}
}

new Card();
'use strict';

class Filter {
	constructor() {
		this._buttons = Array.from(document.querySelectorAll('.filter__button'));
		this._active = 'filter__button_active';

		this._addEventListener();
	}

	_addEventListener() {
		this._buttons.forEach(button => {
			button.addEventListener('click', _ => this._activateButton(button));
		});
	}

	_activateButton(current_button) {
		if (current_button.classList.contains(this._active)) return;

		//disactivate the other buttons.
		current_button.classList.add(this._active);
		this._buttons.forEach(button => {
			if (button !== current_button) button.classList.remove(this._active);
		});

		//get the url and get the page out of it.
		//then replace the current page content with the new content.
		const url = current_button.href;
		//new FetchPage(url, container);
	}
}

new Filter();
'use strict';
'use strict';

class Menu {
    constructor() {
        this.showButtonEl = document.querySelector('.js-menu-show');
        this.hideButtonEl = document.querySelector('.js-menu-hide');
        this.sideNavEl = document.querySelector('.js-side-nav');
        this.sideNavContainerEl = document.querySelector('.js-side-nav-container');

        this.showSideNav = this.showSideNav.bind(this);
        this.hideSideNav = this.hideSideNav.bind(this);
        this.blockClicks = this.blockClicks.bind(this);
        this.onTouchStart = this.onTouchStart.bind(this);
        this.onTouchMove = this.onTouchMove.bind(this);
        this.onTouchEnd = this.onTouchEnd.bind(this);
        this.onTransitionEnd = this.onTransitionEnd.bind(this);
        this.update = this.update.bind(this);

        this.startX = 0;
        this.currentX = 0;
        this.touchingSideNav = false;

        this.transitionEndProperty = null;
        this.transitionEndTime = 0;

        this.supportsPassive = undefined;
        this.addEventListeners();
    }

    applyPassive() {
        if (this.supportsPassive !== undefined) {
            return this.supportsPassive ? { passive: true } : false;
        }
        
        let isSupported = false;
        try {
            document.addEventListener('test', null, {
                get passive() {
                    isSupported = true;
                }
            });
        } catch (e) { }
        this.supportsPassive = isSupported;
        return this.applyPassive();
    }

    addEventListeners() {
        this.showButtonEl.addEventListener('click', this.showSideNav);
        this.hideButtonEl.addEventListener('click', this.hideSideNav);
        this.sideNavEl.addEventListener('click', this.hideSideNav);
        this.sideNavContainerEl.addEventListener('click', this.blockClicks);

        this.sideNavEl.addEventListener('touchstart', this.onTouchStart, this.applyPassive());
        this.sideNavEl.addEventListener('touchmove', this.onTouchMove, this.applyPassive());
        this.sideNavEl.addEventListener('touchend', this.onTouchEnd);
    }

    onTouchStart(evt) {
        if (!this.sideNavEl.classList.contains('side-nav--visible'))
            return;

        this.startX = evt.touches[0].pageX;
        this.currentX = this.startX;

        this.touchingSideNav = true;
        requestAnimationFrame(this.update);
    }

    onTouchMove(evt) {
        if (!this.touchingSideNav)
            return;

        this.currentX = evt.touches[0].pageX;
    }

    onTouchEnd(evt) {
        if (!this.touchingSideNav)
            return;

        this.touchingSideNav = false;

        const translateX = Math.min(0, this.currentX - this.startX);
        this.sideNavContainerEl.style.transform = '';

        if (translateX < 0) {
            this.hideSideNav();
        }
    }

    update() {
        if (!this.touchingSideNav)
            return;

        requestAnimationFrame(this.update);

        const translateX = Math.min(0, this.currentX - this.startX);
        this.sideNavContainerEl.style.transform = `translateX(${translateX}px)`;
    }

    blockClicks(evt) {
        evt.stopPropagation();
    }

    onTransitionEnd(evt) {
        if (evt.propertyName != this.transitionEndProperty && evt.elapsedTime != this.transitionEndTime) {
            return;
        }

        this.transitionEndProperty = null;
        this.transitionEndTime = 0;

        this.sideNavEl.classList.remove('side-nav--animatable');
        this.sideNavEl.removeEventListener('transitionend', this.onTransitionEnd);
    }

    showSideNav() {
        this.sideNavEl.classList.add('side-nav--animatable');
        this.sideNavEl.classList.add('side-nav--visible');

        this.transitionEndProperty = 'transform';
        this.transitionEndTime = 0.33;

        this.sideNavEl.addEventListener('transitionend', this.onTransitionEnd);
    }

    hideSideNav() {
        this.sideNavEl.classList.add('side-nav--animatable');
        this.sideNavEl.classList.remove('side-nav--visible');

        this.transitionEndProperty = 'transform';
        this.transitionEndTime = 0.13;

        this.sideNavEl.addEventListener('transitionend', this.onTransitionEnd);
    }
}

new Menu();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL2NhcmQuanMiLCJqcy9maWx0ZXIuanMiLCJqcy9tYWluLmpzIiwianMvbWVudS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY2xhc3MgQ2FyZCB7XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuX2NhcmRzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FyZCcpKTtcblx0XHR0aGlzLl9pc19saWtlZCA9ICdjYXJkX19idXR0b25faXMtbGlrZWQnO1xuXHRcdHRoaXMuX2lzX2Rpc2xpa2VkID0gJ2NhcmRfX2J1dHRvbl9pcy1kaXNsaWtlZCc7XG5cdFx0dGhpcy5fc3ZnX2xpa2VkID0gJ3N2Z19fY2FyZF9pcy1saWtlZCc7XG5cdFx0dGhpcy5fc3ZnX2Rpc2xpa2VkID0gJ3N2Z19fY2FyZF9pcy1kaXNsaWtlZCc7XG5cblx0XHR0aGlzLl9hZGRFdmVudExpc3RlbmVyKCk7XG5cdH1cblxuXHRfYWRkRXZlbnRMaXN0ZW5lcigpIHtcblx0XHR0aGlzLl9jYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuXHRcdFx0Y29uc3QgdGhlX2J1dHRvbnMgPSBBcnJheS5mcm9tKGNhcmQucXVlcnlTZWxlY3RvckFsbCgnLmNhcmRfX2J1dHRvbicpKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5faGFuZGxlQ2FyZCh0aGVfYnV0dG9ucywgY2FyZCk7XG5cdFx0fSk7XG5cdH1cblxuXHRfaGFuZGxlQ2FyZChidXR0b25zLCBjYXJkKSB7XG5cdFx0YnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG5cdFx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfID0+IHRoaXMuX3RvZ2dsZUNhcmRCdXR0b24oYnV0dG9uLCBidXR0b25zLCBjYXJkKSk7XG5cdFx0fSk7XG5cdH1cblxuXHRfdG9nZ2xlQ2FyZEJ1dHRvbihjdXJyZW50X2J1dHRvbiwgYnV0dG9ucywgY2FyZCkge1xuXHRcdGlmIChjdXJyZW50X2J1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcmRfX2J1dHRvbl9kaXNsaWtlJykpIHtcblx0XHRcdGlmIChjdXJyZW50X2J1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcmRfX2J1dHRvbl9pcy1kaXNsaWtlZCcpKSB7XG5cdFx0XHRcdGN1cnJlbnRfYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2J1dHRvbl9pcy1kaXNsaWtlZCcpO1xuXHRcdFx0XHRjdXJyZW50X2J1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdzdmdfX2NhcmRfaXMtZGlzbGlrZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGN1cnJlbnRfYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2J1dHRvbl9pcy1kaXNsaWtlZCcpO1xuXHRcdFx0XHRjdXJyZW50X2J1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKS5jbGFzc0xpc3QuYWRkKCdzdmdfX2NhcmRfaXMtZGlzbGlrZWQnKTtcblxuXHRcdFx0XHRidXR0b25zLmZvckVhY2goYnV0dG9uID0+ICB7XG5cdFx0XHRcdFx0aWYgKGJ1dHRvbiAhPT0gY3VycmVudF9idXR0b24pIHtcblx0XHRcdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjYXJkX19idXR0b25faXMtbGlrZWQnKTtcblx0XHRcdFx0XHRcdGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdzdmdfX2NhcmRfaXMtbGlrZWQnKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vYWRkIHRoZSBmZWVkYmFjayB0byB0aGUgZGF0YWJhc2Vcblx0XHRcdFx0Y29uc3QgdXJsID0gY3VycmVudF9idXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWhyZWYnKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKGN1cnJlbnRfYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnY2FyZF9fYnV0dG9uX2xpa2UnKSkge1xuXHRcdFx0aWYgKGN1cnJlbnRfYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnY2FyZF9fYnV0dG9uX2lzLWxpa2VkJykpIHtcblx0XHRcdFx0Y3VycmVudF9idXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fYnV0dG9uX2lzLWxpa2VkJyk7XG5cdFx0XHRcdGN1cnJlbnRfYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpLmNsYXNzTGlzdC5yZW1vdmUoJ3N2Z19fY2FyZF9pcy1saWtlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y3VycmVudF9idXR0b24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fYnV0dG9uX2lzLWxpa2VkJyk7XG5cdFx0XHRcdGN1cnJlbnRfYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpLmNsYXNzTGlzdC5hZGQoJ3N2Z19fY2FyZF9pcy1saWtlZCcpO1xuXG5cdFx0XHRcdGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gIHtcblx0XHRcdFx0XHRpZiAoYnV0dG9uICE9PSBjdXJyZW50X2J1dHRvbikge1xuXHRcdFx0XHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2J1dHRvbl9pcy1kaXNsaWtlZCcpO1xuXHRcdFx0XHRcdFx0YnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpLmNsYXNzTGlzdC5yZW1vdmUoJ3N2Z19fY2FyZF9pcy1kaXNsaWtlZCcpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly9hZGQgdGhlIGZlZWRiYWNrIHRvIHRoZSBkYXRhYmFzZVxuXHRcdFx0XHRjb25zdCB1cmwgPSBjdXJyZW50X2J1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaHJlZicpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYXJkLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2lzLXJlbW92ZWQnKTtcblx0XHRcdHNldFRpbWVvdXQoXyA9PiBjYXJkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpLCA0MDApO1xuXG5cdFx0XHRjb25zdCB1cmwgPSBjdXJyZW50X2J1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaHJlZicpO1xuXHRcdFx0Y29uc29sZS5sb2codXJsKTtcblx0XHR9XG5cdH1cblxuXHRfY2FyZFN0YXR1cyh1cmwsIGNhcmQpIHtcblx0XHRjb25zdCBpZCA9IGNhcmQuZ2V0QXR0cmlidXRlKCdkYXRhLXNob3AnKTtcblx0XHRjb25zdCBvcHRpb25zID0ge1xuXHRcdFx0bWV0aG9kOiAnUFVUJyxcblx0XHRcdGJvZHk6IHsnaWQnOiBpZH1cblx0XHR9O1xuXG5cdFx0ZmV0Y2godXJsLCBvcHRpb25zKVxuXHRcdFx0LnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiBjb25zb2xlLmxvZyhyZXNwb25zZSkpO1xuXHR9XG59XG5cbm5ldyBDYXJkKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5jbGFzcyBGaWx0ZXIge1xuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLl9idXR0b25zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyX19idXR0b24nKSk7XG5cdFx0dGhpcy5fYWN0aXZlID0gJ2ZpbHRlcl9fYnV0dG9uX2FjdGl2ZSc7XG5cblx0XHR0aGlzLl9hZGRFdmVudExpc3RlbmVyKCk7XG5cdH1cblxuXHRfYWRkRXZlbnRMaXN0ZW5lcigpIHtcblx0XHR0aGlzLl9idXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcblx0XHRcdGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF8gPT4gdGhpcy5fYWN0aXZhdGVCdXR0b24oYnV0dG9uKSk7XG5cdFx0fSk7XG5cdH1cblxuXHRfYWN0aXZhdGVCdXR0b24oY3VycmVudF9idXR0b24pIHtcblx0XHRpZiAoY3VycmVudF9idXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuX2FjdGl2ZSkpIHJldHVybjtcblxuXHRcdC8vZGlzYWN0aXZhdGUgdGhlIG90aGVyIGJ1dHRvbnMuXG5cdFx0Y3VycmVudF9idXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9hY3RpdmUpO1xuXHRcdHRoaXMuX2J1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuXHRcdFx0aWYgKGJ1dHRvbiAhPT0gY3VycmVudF9idXR0b24pIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2FjdGl2ZSk7XG5cdFx0fSk7XG5cblx0XHQvL2dldCB0aGUgdXJsIGFuZCBnZXQgdGhlIHBhZ2Ugb3V0IG9mIGl0LlxuXHRcdC8vdGhlbiByZXBsYWNlIHRoZSBjdXJyZW50IHBhZ2UgY29udGVudCB3aXRoIHRoZSBuZXcgY29udGVudC5cblx0XHRjb25zdCB1cmwgPSBjdXJyZW50X2J1dHRvbi5ocmVmO1xuXHRcdC8vbmV3IEZldGNoUGFnZSh1cmwsIGNvbnRhaW5lcik7XG5cdH1cbn1cblxubmV3IEZpbHRlcigpOyIsIid1c2Ugc3RyaWN0JzsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5jbGFzcyBNZW51IHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0J1dHRvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLW1lbnUtc2hvdycpO1xyXG4gICAgICAgIHRoaXMuaGlkZUJ1dHRvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLW1lbnUtaGlkZScpO1xyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXNpZGUtbmF2Jyk7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2Q29udGFpbmVyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc2lkZS1uYXYtY29udGFpbmVyJyk7XHJcblxyXG4gICAgICAgIHRoaXMuc2hvd1NpZGVOYXYgPSB0aGlzLnNob3dTaWRlTmF2LmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5oaWRlU2lkZU5hdiA9IHRoaXMuaGlkZVNpZGVOYXYuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLmJsb2NrQ2xpY2tzID0gdGhpcy5ibG9ja0NsaWNrcy5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMub25Ub3VjaFN0YXJ0ID0gdGhpcy5vblRvdWNoU3RhcnQuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLm9uVG91Y2hNb3ZlID0gdGhpcy5vblRvdWNoTW92ZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMub25Ub3VjaEVuZCA9IHRoaXMub25Ub3VjaEVuZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMub25UcmFuc2l0aW9uRW5kID0gdGhpcy5vblRyYW5zaXRpb25FbmQuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZSA9IHRoaXMudXBkYXRlLmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIHRoaXMuc3RhcnRYID0gMDtcclxuICAgICAgICB0aGlzLmN1cnJlbnRYID0gMDtcclxuICAgICAgICB0aGlzLnRvdWNoaW5nU2lkZU5hdiA9IGZhbHNlO1xyXG5cclxuICAgICAgICB0aGlzLnRyYW5zaXRpb25FbmRQcm9wZXJ0eSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uRW5kVGltZSA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMuc3VwcG9ydHNQYXNzaXZlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBhcHBseVBhc3NpdmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3VwcG9ydHNQYXNzaXZlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3VwcG9ydHNQYXNzaXZlID8geyBwYXNzaXZlOiB0cnVlIH0gOiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGlzU3VwcG9ydGVkID0gZmFsc2U7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndGVzdCcsIG51bGwsIHtcclxuICAgICAgICAgICAgICAgIGdldCBwYXNzaXZlKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgdGhpcy5zdXBwb3J0c1Bhc3NpdmUgPSBpc1N1cHBvcnRlZDtcclxuICAgICAgICByZXR1cm4gdGhpcy5hcHBseVBhc3NpdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLnNob3dCdXR0b25FbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2hvd1NpZGVOYXYpO1xyXG4gICAgICAgIHRoaXMuaGlkZUJ1dHRvbkVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oaWRlU2lkZU5hdik7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2RWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhpZGVTaWRlTmF2KTtcclxuICAgICAgICB0aGlzLnNpZGVOYXZDb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuYmxvY2tDbGlja3MpO1xyXG5cclxuICAgICAgICB0aGlzLnNpZGVOYXZFbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vblRvdWNoU3RhcnQsIHRoaXMuYXBwbHlQYXNzaXZlKCkpO1xyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMub25Ub3VjaE1vdmUsIHRoaXMuYXBwbHlQYXNzaXZlKCkpO1xyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vblRvdWNoRW5kKTtcclxuICAgIH1cclxuXHJcbiAgICBvblRvdWNoU3RhcnQoZXZ0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNpZGVOYXZFbC5jbGFzc0xpc3QuY29udGFpbnMoJ3NpZGUtbmF2LS12aXNpYmxlJykpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5zdGFydFggPSBldnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICB0aGlzLmN1cnJlbnRYID0gdGhpcy5zdGFydFg7XHJcblxyXG4gICAgICAgIHRoaXMudG91Y2hpbmdTaWRlTmF2ID0gdHJ1ZTtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy51cGRhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVG91Y2hNb3ZlKGV2dCkge1xyXG4gICAgICAgIGlmICghdGhpcy50b3VjaGluZ1NpZGVOYXYpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5jdXJyZW50WCA9IGV2dC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVG91Y2hFbmQoZXZ0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRvdWNoaW5nU2lkZU5hdilcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICB0aGlzLnRvdWNoaW5nU2lkZU5hdiA9IGZhbHNlO1xyXG5cclxuICAgICAgICBjb25zdCB0cmFuc2xhdGVYID0gTWF0aC5taW4oMCwgdGhpcy5jdXJyZW50WCAtIHRoaXMuc3RhcnRYKTtcclxuICAgICAgICB0aGlzLnNpZGVOYXZDb250YWluZXJFbC5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuXHJcbiAgICAgICAgaWYgKHRyYW5zbGF0ZVggPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZVNpZGVOYXYoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKCkge1xyXG4gICAgICAgIGlmICghdGhpcy50b3VjaGluZ1NpZGVOYXYpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudXBkYXRlKTtcclxuXHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRlWCA9IE1hdGgubWluKDAsIHRoaXMuY3VycmVudFggLSB0aGlzLnN0YXJ0WCk7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2Q29udGFpbmVyRWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHt0cmFuc2xhdGVYfXB4KWA7XHJcbiAgICB9XHJcblxyXG4gICAgYmxvY2tDbGlja3MoZXZ0KSB7XHJcbiAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVHJhbnNpdGlvbkVuZChldnQpIHtcclxuICAgICAgICBpZiAoZXZ0LnByb3BlcnR5TmFtZSAhPSB0aGlzLnRyYW5zaXRpb25FbmRQcm9wZXJ0eSAmJiBldnQuZWxhcHNlZFRpbWUgIT0gdGhpcy50cmFuc2l0aW9uRW5kVGltZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRyYW5zaXRpb25FbmRQcm9wZXJ0eSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uRW5kVGltZSA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsLmNsYXNzTGlzdC5yZW1vdmUoJ3NpZGUtbmF2LS1hbmltYXRhYmxlJyk7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2RWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIHRoaXMub25UcmFuc2l0aW9uRW5kKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93U2lkZU5hdigpIHtcclxuICAgICAgICB0aGlzLnNpZGVOYXZFbC5jbGFzc0xpc3QuYWRkKCdzaWRlLW5hdi0tYW5pbWF0YWJsZScpO1xyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsLmNsYXNzTGlzdC5hZGQoJ3NpZGUtbmF2LS12aXNpYmxlJyk7XHJcblxyXG4gICAgICAgIHRoaXMudHJhbnNpdGlvbkVuZFByb3BlcnR5ID0gJ3RyYW5zZm9ybSc7XHJcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uRW5kVGltZSA9IDAuMzM7XHJcblxyXG4gICAgICAgIHRoaXMuc2lkZU5hdkVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCB0aGlzLm9uVHJhbnNpdGlvbkVuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZVNpZGVOYXYoKSB7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2RWwuY2xhc3NMaXN0LmFkZCgnc2lkZS1uYXYtLWFuaW1hdGFibGUnKTtcclxuICAgICAgICB0aGlzLnNpZGVOYXZFbC5jbGFzc0xpc3QucmVtb3ZlKCdzaWRlLW5hdi0tdmlzaWJsZScpO1xyXG5cclxuICAgICAgICB0aGlzLnRyYW5zaXRpb25FbmRQcm9wZXJ0eSA9ICd0cmFuc2Zvcm0nO1xyXG4gICAgICAgIHRoaXMudHJhbnNpdGlvbkVuZFRpbWUgPSAwLjEzO1xyXG5cclxuICAgICAgICB0aGlzLnNpZGVOYXZFbC5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgdGhpcy5vblRyYW5zaXRpb25FbmQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5uZXcgTWVudSgpOyJdfQ==
